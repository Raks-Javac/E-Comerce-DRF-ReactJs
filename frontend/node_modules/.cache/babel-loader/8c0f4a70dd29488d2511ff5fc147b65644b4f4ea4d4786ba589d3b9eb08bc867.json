{"ast":null,"code":"import _objectSpread from\"/Users/kudusrufai/Desktop/codes/backend/python/e_commerce/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useReducer}from'react';import{authService}from'../services/auth';import{jsx as _jsx}from\"react/jsx-runtime\";const initialState={user:null,isAuthenticated:false,loading:true};const authReducer=(state,action)=>{switch(action.type){case'SET_LOADING':return _objectSpread(_objectSpread({},state),{},{loading:action.payload});case'SET_USER':return _objectSpread(_objectSpread({},state),{},{user:action.payload,isAuthenticated:true,loading:false});case'CLEAR_USER':return _objectSpread(_objectSpread({},state),{},{user:null,isAuthenticated:false,loading:false});case'UPDATE_USER':return _objectSpread(_objectSpread({},state),{},{user:state.user?_objectSpread(_objectSpread({},state.user),action.payload):null});default:return state;}};const AuthContext=/*#__PURE__*/createContext(undefined);export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[state,dispatch]=useReducer(authReducer,initialState);useEffect(()=>{const initAuth=async()=>{const token=localStorage.getItem('access_token');if(token){try{const user=await authService.getProfile();dispatch({type:'SET_USER',payload:user});}catch(error){localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');dispatch({type:'CLEAR_USER'});}}else{dispatch({type:'SET_LOADING',payload:false});}};initAuth();},[]);const login=async credentials=>{try{const response=await authService.login(credentials);localStorage.setItem('access_token',response.access);localStorage.setItem('refresh_token',response.refresh);dispatch({type:'SET_USER',payload:response.user});}catch(error){throw error;}};const register=async userData=>{try{const response=await authService.register(userData);localStorage.setItem('access_token',response.access);localStorage.setItem('refresh_token',response.refresh);dispatch({type:'SET_USER',payload:response.user});}catch(error){throw error;}};const logout=async()=>{try{const refreshToken=localStorage.getItem('refresh_token');if(refreshToken){await authService.logout(refreshToken);}}catch(error){console.error('Logout error:',error);}finally{localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');dispatch({type:'CLEAR_USER'});}};const updateUser=userData=>{dispatch({type:'UPDATE_USER',payload:userData});};const value=_objectSpread(_objectSpread({},state),{},{login,register,logout,updateUser});return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useReducer","authService","jsx","_jsx","initialState","user","isAuthenticated","loading","authReducer","state","action","type","_objectSpread","payload","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","dispatch","initAuth","token","localStorage","getItem","getProfile","error","removeItem","login","credentials","response","setItem","access","refresh","register","userData","logout","refreshToken","console","updateUser","value","Provider"],"sources":["/Users/kudusrufai/Desktop/codes/backend/python/e_commerce/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useReducer } from 'react';\nimport { authService } from '../services/auth';\nimport { AuthResponse, User } from '../types';\n\ninterface AuthState {\n    user: User | null;\n    isAuthenticated: boolean;\n    loading: boolean;\n}\n\ninterface AuthContextType extends AuthState {\n    login: (credentials: { email: string; password: string }) => Promise<void>;\n    register: (userData: any) => Promise<void>;\n    logout: () => void;\n    updateUser: (userData: Partial<User>) => void;\n}\n\ntype AuthAction =\n    | { type: 'SET_LOADING'; payload: boolean }\n    | { type: 'SET_USER'; payload: User }\n    | { type: 'CLEAR_USER' }\n    | { type: 'UPDATE_USER'; payload: Partial<User> };\n\nconst initialState: AuthState = {\n    user: null,\n    isAuthenticated: false,\n    loading: true,\n};\n\nconst authReducer = (state: AuthState, action: AuthAction): AuthState => {\n    switch (action.type) {\n        case 'SET_LOADING':\n            return { ...state, loading: action.payload };\n        case 'SET_USER':\n            return {\n                ...state,\n                user: action.payload,\n                isAuthenticated: true,\n                loading: false,\n            };\n        case 'CLEAR_USER':\n            return {\n                ...state,\n                user: null,\n                isAuthenticated: false,\n                loading: false,\n            };\n        case 'UPDATE_USER':\n            return {\n                ...state,\n                user: state.user ? { ...state.user, ...action.payload } : null,\n            };\n        default:\n            return state;\n    }\n};\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => {\n    const context = useContext(AuthContext);\n    if (context === undefined) {\n        throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n};\n\ninterface AuthProviderProps {\n    children: React.ReactNode;\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n    const [state, dispatch] = useReducer(authReducer, initialState);\n\n    useEffect(() => {\n        const initAuth = async () => {\n            const token = localStorage.getItem('access_token');\n            if (token) {\n                try {\n                    const user = await authService.getProfile();\n                    dispatch({ type: 'SET_USER', payload: user });\n                } catch (error) {\n                    localStorage.removeItem('access_token');\n                    localStorage.removeItem('refresh_token');\n                    dispatch({ type: 'CLEAR_USER' });\n                }\n            } else {\n                dispatch({ type: 'SET_LOADING', payload: false });\n            }\n        };\n\n        initAuth();\n    }, []);\n\n    const login = async (credentials: { email: string; password: string }) => {\n        try {\n            const response: AuthResponse = await authService.login(credentials);\n            localStorage.setItem('access_token', response.access);\n            localStorage.setItem('refresh_token', response.refresh);\n            dispatch({ type: 'SET_USER', payload: response.user });\n        } catch (error) {\n            throw error;\n        }\n    };\n\n    const register = async (userData: any) => {\n        try {\n            const response: AuthResponse = await authService.register(userData);\n            localStorage.setItem('access_token', response.access);\n            localStorage.setItem('refresh_token', response.refresh);\n            dispatch({ type: 'SET_USER', payload: response.user });\n        } catch (error) {\n            throw error;\n        }\n    };\n\n    const logout = async () => {\n        try {\n            const refreshToken = localStorage.getItem('refresh_token');\n            if (refreshToken) {\n                await authService.logout(refreshToken);\n            }\n        } catch (error) {\n            console.error('Logout error:', error);\n        } finally {\n            localStorage.removeItem('access_token');\n            localStorage.removeItem('refresh_token');\n            dispatch({ type: 'CLEAR_USER' });\n        }\n    };\n\n    const updateUser = (userData: Partial<User>) => {\n        dispatch({ type: 'UPDATE_USER', payload: userData });\n    };\n\n    const value: AuthContextType = {\n        ...state,\n        login,\n        register,\n        logout,\n        updateUser,\n    };\n\n    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}